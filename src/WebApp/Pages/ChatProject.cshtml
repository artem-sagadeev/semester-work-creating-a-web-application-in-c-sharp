@page
@using WebApp.Models.Identity
@using Microsoft.AspNetCore.Identity
@model WebApp.Pages.ChatProject

@inject UserManager<ApplicationUser> _userManager
@{
    //var userId = (await _userManager.GetUserAsync(User))?.UserId;
    //var projectId = @Model.ProjectModel.Id;
    var userId = 1;
    var projectId = 1;
}

<div id="inputForm">
    <input type="text" id="message"/>
    <input type="button" id="sendBtn" value="Отправить"/>
</div>
<div id="chatroom"></div>
<script src="js/signalr/dist/browser/signalr.min.js"></script>

<script>
        const hubConnection = new signalR.HubConnectionBuilder()
            .withUrl("/chat")
            .build(); 
              
        // получение сообщения от сервера
        hubConnection.on('Send', function (message, userId, userName, projectId) {
            // создаем элемент <b> для имени пользователя
            let userNameElem = document.createElement("b");
            userNameElem.appendChild(document.createTextNode(userName + ': '));
  
            // создает элемент <p> для сообщения пользователя
            let elem = document.createElement("p");
            elem.appendChild(userNameElem);
            elem.appendChild(document.createTextNode(message));
  
            var firstElem = document.getElementById("chatroom").firstChild;
            document.getElementById("chatroom").insertBefore(elem, firstElem);  
        });
                
        // отправка сообщения на сервер
        document.getElementById("sendBtn").addEventListener("click", function (e) {
            let message = document.getElementById("message").value;
            let userName = '';
            hubConnection.invoke("Send", message, @userId, userName, @projectId);
        });
 
        hubConnection.start();
    </script>